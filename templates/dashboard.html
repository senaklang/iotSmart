{% extends "base.html" %} {% block title %}Dashboard | IoT Monitoring{% endblock
%} {% block script_extra %}
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>IoT Dashboard</title>
<!-- Fonts -->
<link
  href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap"
  rel="stylesheet"
/>
<!-- Bootstrap CSS -->
<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
  rel="stylesheet"
/>
<!-- Bootstrap Icons -->
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
/>
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment@1.0.0"></script>
<!-- Custom CSS -->
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/dashboard.css') }}"
/>
<!-- เพิ่มก่อนส่วน JavaScript ของคุณ -->
<link
  href="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/style.css"
  rel="stylesheet"
/>
<script src="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/umd/simple-datatables.min.js"></script>

<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>

{% endblock %} 

{% block content %}
<nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">
      <i class="bi bi-cpu-fill me-2"></i>IoT Hydroponics Dashboard
    </a>
    <button
      class="navbar-toggler"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarNav"
    >
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item">
          <a class="nav-link" href="/dashboard"
            ><i class="bi bi-speedometer2 me-1"></i>Dashboard</a
          >
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/settings"
            ><i class="bi bi-gear me-1"></i>Settings</a
          >
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/apihtml"
            ><i class="bi bi-code-slash me-1"></i>API</a
          >
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="container-fluid">
  <!-- Alert Container -->
  <div id="alert-container" class="mb-3"></div>
  <div class="text-end text-muted small p-2 m-3" id="last-updated">
    Last updated: --
  </div>
  <!-- Real-time Data Row -->
  <div class="row mb-4">
    <!-- Temperature Card -->
    <div class="col-md-3">
      <div class="card border-start-primary shadow h-100 py-2">
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col me-2">
              <div class="text-xs fw-bold text-primary text-uppercase mb-1">
                Temperature
              </div>
              <div
                class="h5 mb-0 fw-bold text-gray-800"
                id="temperature-display"
              >
                -- °C
              </div>
            </div>
            <div class="col-auto">
              <i class="bi bi-thermometer-half fs-1 text-primary"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Humidity Card -->
    <div class="col-md-3">
      <div class="card border-start-success shadow h-100 py-2">
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col me-2">
              <div class="text-xs fw-bold text-success text-uppercase mb-1">
                Humidity
              </div>
              <div class="h5 mb-0 fw-bold text-gray-800" id="humidity-display">
                -- %
              </div>
            </div>
            <div class="col-auto">
              <i class="bi bi-droplet-half fs-1 text-success"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- TDS Card -->
    <div class="col-md-3">
      <div class="card border-start-info shadow h-100 py-2">
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col me-2">
              <div class="text-xs fw-bold text-info text-uppercase mb-1">
                TDS
              </div>
              <div class="h5 mb-0 fw-bold text-gray-800" id="tds-display">
                -- ppm
              </div>
            </div>
            <div class="col-auto">
              <i class="bi bi-lightning-charge fs-1 text-info"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- pH Card -->
    <div class="col-md-3">
      <div class="card border-start-warning shadow h-100 py-2">
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col me-2">
              <div class="text-xs fw-bold text-warning text-uppercase mb-1">
                pH
              </div>
              <div class="h5 mb-0 fw-bold text-gray-800" id="ph-display">
                --
              </div>
            </div>
            <div class="col-auto">
              <i class="bi bi-droplet fs-1 text-warning"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Control Panels Row -->
  <div class="row mb-4">
    <!-- Light & Fan Control -->
    <div class="col-lg-6">
      <div class="card shadow mb-4">
        <div
          class="card-header py-3 d-flex flex-row align-items-center justify-content-between"
        >
          <h6 class="m-0 fw-bold text-danger">Light & Fan Control</h6>
        </div>
        <div class="card-body">
          <button class="btn btn-success me-2" >
                <i class="bi bi-controller"></i> Comport Detail
                <i id="comdetails" class="bi detail"></i> ....
            </button>
          <div id="lampStatusContainer" class="mb-4">
            <!-- ปุ่มควบคุมแต่ละ lamp จะถูก generate โดย JavaScript -->
          </div>

          <div class="mb-3">
            <h6 class="fw-bold">Fan Speed Control</h6>
            <div class="mb-3">
              <label for="fanSpeedRange" class="form-label">
                Current Speed: <span id="fanSpeedValue">50</span>%
              </label>
              <input
                type="range"
                class="form-range"
                min="0"
                max="100"
                value="50"
                id="fanSpeedRange"
              />
            </div>
            <button
              class="btn btn-primary w-100"
              onclick="controlDevice('fan', 'set', document.getElementById('fanSpeedRange').value)"
            >
              <i class="bi bi-fan"></i> Set Fan Speed
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- pH Control -->
    <div class="col-lg-6">
      <div class="card shadow mb-4">
        <div
          class="card-header py-3 d-flex flex-row align-items-center justify-content-between"
        >
          <h6 class="m-0 fw-bold text-success">pH Control System</h6>
        </div>
        <div class="card-body">
          <div class="mb-4">
            <h6 class="fw-bold">Target pH Setting</h6>
            <div class="input-group mb-3">
              <input
                type="number"
                class="form-control"
                id="phTarget"
                step="0.1"
                min="4.0"
                max="8.0"
                value="6.0"
              />
              <button
                class="btn btn-primary"
                type="button"
                onclick="controlDevice('ph', 'set_target', document.getElementById('phTarget').value)"
              >
                <i class="bi bi-check-circle"></i> Set
              </button>
            </div>
          </div>

          <div>
            <h6 class="fw-bold">Manual pH Adjustment</h6>
            <div class="d-grid gap-2">
              <button
                class="btn btn-info"
                onclick="controlDevice('ph', 'dose_up')"
              >
                <i class="bi bi-arrow-up-circle"></i> Dose pH Up
              </button>
              <button
                class="btn btn-warning"
                onclick="controlDevice('ph', 'dose_down')"
              >
                <i class="bi bi-arrow-down-circle"></i> Dose pH Down
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>

{% endblock %}
